#!/usr/bin/env bash
# Sets up a custom 404 page with the message "Ceci n'est pas une page"

# Install Nginx
apt-get update -y
apt-get install -y nginx

# Create the custom 404 HTML page
echo "Ceci n'est pas une page" > /var/www/html/custom_404.html

# Inject error_page config into the server block if not already there
config="/etc/nginx/sites-available/default"

# Remove any previous custom 404 config to avoid duplicates
sed -i '/error_page 404/d' "$config"
sed -i '/location \/ {/a \
    error_page 404 /custom_404.html;\n\
    location = /custom_404.html {\n\
        internal;\n\
    }' "$config"

# Reload Nginx
nginx -t && service nginx reload
